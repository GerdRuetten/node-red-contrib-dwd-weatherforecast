<script type="text/x-red" data-help-name="dwd-weatherforecast">
    <p>
        Retrieves the official DWD MOSMIX_L forecast for a single weather station
        and exposes it as a time series that can be used in dashboards, automations
        or further processing nodes.
    </p>

    <h3>Inputs</h3>
    <dl class="message-properties">
        <dt>msg.payload
            <span class="property-type">any</span>
        </dt>
        <dd>
            The incoming payload is not interpreted by the node.
            Every incoming message simply acts as a trigger for a new fetch
            (on top of any configured auto-refresh).
        </dd>
    </dl>

    <h3>Outputs</h3>
    <dl class="message-properties">
        <dt>msg.payload
            <span class="property-type">Array&lt;Object&gt;</span>
        </dt>
        <dd>
            Array of forecast points ordered by time.
            Each entry contains at least the timestamp (<code>ts</code>, <code>iso</code>),
            temperature, wind, relative humidity, pressure, visibility, cloud cover and
            precipitation (<code>precipitation</code>, <code>precipitationText</code>).
            Additional convenience fields may be added depending on the configuration.
        </dd>

        <dt>msg.stationId
            <span class="property-type">string</span>
        </dt>
        <dd>
            The DWD station id that was used for the request.
        </dd>

        <dt>msg.meta
            <span class="property-type">Object</span>
        </dt>
        <dd>
            Meta information about the request (time, source, optional diagnostics).
        </dd>
    </dl>

    <h3>Configuration</h3>
    <dl>
        <dt>DWD station ID</dt>
        <dd>
            Official DWD id of the station (for example <code>H721</code> for Cologne/Bonn).
            If left empty the node will fail with an error status.
        </dd>

        <dt>Source URL</dt>
        <dd>
            URL template used to download the MOSMIX_L KMZ file.
            By default the official DWD Open Data endpoint is used.
        </dd>

        <dt>Fetch on deploy</dt>
        <dd>
            Triggers an initial fetch immediately after deployment so that data
            is available without sending a manual inject first.
        </dd>

        <dt>Auto-refresh</dt>
        <dd>
            Optional interval (seconds) for periodic updates without a separate inject node.
        </dd>

        <dt>Lead time / Only future timestamps</dt>
        <dd>
            Limits the forecast horizon and filters out historic MOSMIX values.
        </dd>

        <dt>Output options</dt>
        <dd>
            Controls whether only a minimal core set of fields is returned or
            whether additional convenience fields are included (for example
            cardinal wind direction and converted units).
        </dd>
    </dl>

    <h3>Notes</h3>
    <ul>
        <li>Data is taken from the DWD MOSMIX_L forecast and is usually updated hourly.</li>
        <li>If stale mode is enabled the last successful forecast is kept in context and reused on errors.</li>
        <li>The wind direction mode option can add a human readable <code>windDirCardinal</code> field.</li>
    </ul>
</script>
